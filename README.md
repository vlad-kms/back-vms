## Резервирование dataset'ов на zfs
Создание snapshot'ов и резервных копий-файлов dataset'ов на файловой системе zfs.

usage:

    резервирование по файлу конфигурации:
    back-vol.sh --config <FILENAME.JSON>

    резервирование конкретного DATASET: 
    back-vol.sh
        --name <NAME_DATASET>
        --dest <PATH_DESTINATION>
        --source <DATASET_SOURCE>
        --lifetime <STR_LIFETIME>
        --log <FILENAME_LOG>
        --create-snapshot
        --no-compression
        --dry-run
        --no-remove-tmp
        --debug
        --add-namevm-to-dest

    , где
        <FILENAME.JSON>     - имя JSON файла конфигурации для VM и CONTAINERS которые требуется резервировать  
                              (по умолчанию: cron-vm.json)
        <NAME_DATASET>      - имя DATASET для резервного копирования.
        <PATH_DESTINATION>  - путь к каталогу, в который будет сохранен архив  
                              (по умолчанию: /mnt/base-pool/vms/backup)
        <DATASET_SOURCE>    - путь к источнику для резервного копирования  
                              (по умолчанию: base-pool/vms)
        <STR_LIFETIME>      - время хранения архива в формате:
                                1m  - хранить месяцев,
                                1d  - хранить дней,
                                1w  - хранить недель,
                                d   - не удалаяются устаревшие копии
                              (по умолчанию: 1m, 1 месяц)
        <FILENAME_LOG>      - файл для записи лога, если не указан, то не логировать  
                              (по умолчанию: , нет файла для логирования, не вести логи)
                              
    Описание JSON файла конфигурации:
    {
        // Обязательная секция со значениями по-умолчанию.
        // Если в секции конкретной VM (контейнера) нет такого ключа,
        // то значение будем брать из этой секции, это и есть значение по-умолчанию.
        // Значение аргумента командной строки, соответствующее параметру из файла
        // конфигурации секции <default>, если задано, переопределяет это значение по-умолчанию
        "default": {
            "Enabled": "True",          // включено или нет резервирование
            "LifeTime": "1m",           // удалять (или нет) и срок жизни устаревших резервных копий
            "Destination": "/mnt/vms",  // путь куда будем складывать резервные копии
            "AddNameVMToDest": "True",  // добавить имя VM постфиксом к DEST
            "Source": "test/ds1/back",  // полный путь к VOLUME (DATASET)
            "Compression": "True",      // включить или нет сжатие
            "Debug": "False",           // вывод отладочной информации
            "DryRun": "False",          // не выполнять фактически команды
            "CreateSnapshot": "True",   // создавать снапшоты или брать последний из ранее созданных
            "NoRemoveTemp": "False",    // не удалять временные файлы
            "Datasets": []              // массив datasets данной VM для резервирования.
                                        // если он пустой (size=0), то dataset == имени секции (VM)
                                        // можно передавать только имя dataset ('ds1'), в этом случае
                                        // будем резервировать <Source>/ds1>
                                        // можно передавать полное имя dataset ('base-pool/test/ds2'), в этом случае
                                        // будем резервировать base-pool/test/ds2>
        },
        // секция конкретной VM (CONTAINER) для резервирования
        // здесь параметр
        "dev-deb-001": {
            "Debug": "True",
            "DryRun": "True".
            "Datasets": [
                "vol_1",
                "vol_2",
                "test/ds2/.sys/vm/vol_3"
            ]
        },
        "dev-deb-003": {
            "Enabled": "False"
        }
    }

Данный скрипт создает снапшоты и резервирует снапшоты в файл.  
Аргументы используются для разных целей при запуске скрипта:
***
    В первом случае, резервирование по файлу конфигурации, если они переданы, то они переопределяют значение по-умолчанию из секции <default>.
    Во втором случае, аргументы задают параметры резервирования для конкретного dataset <NAME_DATASET>
***
**"Enabled"**  
    Резервировать или нет VM

**"LifeTime" || --lifetime**  

    удалять (или нет) устаревшие SNAPSHOT'ы и файлы резрвных копия, а также их срок жизни

**"Destination" || --dest**  

    путь куда будем складывать резервные копии

**"AddNameVMToDest" || --add-namevm-to-dest**  

    добавить имя VM постфиксом к DEST, т.е. архивировать будем в каталог Destination/NAME_VM(NAME_DATASET)

**"Source" || --source**  

    полный путь к источнику DATASET

**"Compression"**  

    Если "True", то включить сжатие

**"--no-compression"**  

    Если передан в командной строке, то отключить сжатие


**"Debug" || --debug**  

    вывод отладочной информации

**"DryRun" || --dry-run**  

    не выполнять фактически команды, а вывод их на экран

**"CreateSnapshot" || --create-sn**  

    Если True || передан в командной строке, то создается снапшот по шаблону (NAME_DATASET@auto-YYYY-mm-dd_MM-HH). Иначе берется последний созданный снапшот и он резервируется в файл

**"CreateSnapshot" || --create-sn** 
    
    создавать снапшоты или брать последний из ранее созданных

**"NoRemoveTemp" || --no-remove-tmp**  

    не удалять временные файлы

**"Datasets"**  

    массив datasets данной VM для резервирования.
    если он пустой (size=0), то dataset == имени секции (VM)
    можно передавать только имя dataset ('ds1'), в этом случае
    будем резервировать <Source>/ds1>
    можно передавать полное имя dataset ('base-pool/test/ds2'), в этом случае
    будем резервировать base-pool/test/ds2>
